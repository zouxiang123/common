<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.xtt.common.dao.mapper.PatientAssayRecordMapper">
  <resultMap id="BaseResultMap" type="com.xtt.common.dao.model.PatientAssayRecord">
    <!--
      WARNING - @mbggenerated, do not modify!
    -->
    <id column="id" jdbcType="VARCHAR" property="id" />
    <result column="fk_patient_id" jdbcType="BIGINT" property="fkPatientId" />
    <result column="his_pt_Id" jdbcType="VARCHAR" property="hisPtId" />
    <result column="group_id" jdbcType="VARCHAR" property="groupId" />
    <result column="group_name" jdbcType="VARCHAR" property="groupName" />
    <result column="item_code" jdbcType="VARCHAR" property="itemCode" />
    <result column="item_name" jdbcType="VARCHAR" property="itemName" />
    <result column="result" jdbcType="VARCHAR" property="result" />
    <result column="result_actual" jdbcType="DOUBLE" property="resultActual" />
    <result column="value_unit" jdbcType="VARCHAR" property="valueUnit" />
    <result column="value_min" jdbcType="DECIMAL" property="valueMin" />
    <result column="value_max" jdbcType="DECIMAL" property="valueMax" />
    <result column="result_tips" jdbcType="VARCHAR" property="resultTips" />
    <result column="reference" jdbcType="VARCHAR" property="reference" />
    <result column="remark" jdbcType="VARCHAR" property="remark" />
    <result column="report_time" jdbcType="TIMESTAMP" property="reportTime" />
    <result column="req_id" jdbcType="VARCHAR" property="reqId" />
    <result column="req_time" jdbcType="TIMESTAMP" property="reqTime" />
    <result column="req_dept" jdbcType="VARCHAR" property="reqDept" />
    <result column="sample_class" jdbcType="VARCHAR" property="sampleClass" />
    <result column="sample_time" jdbcType="TIMESTAMP" property="sampleTime" />
    <result column="send_doctor" jdbcType="VARCHAR" property="sendDoctor" />
    <result column="check_time" jdbcType="TIMESTAMP" property="checkTime" />
    <result column="check_person" jdbcType="VARCHAR" property="checkPerson" />
    <result column="inspection_id" jdbcType="VARCHAR" property="inspectionId" />
    <result column="fk_tenant_id" jdbcType="INTEGER" property="fkTenantId" />
    <result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
    <result column="assay_month" jdbcType="VARCHAR" property="assayMonth" />
    <result column="assay_date" jdbcType="VARCHAR" property="assayDate" />
    <result column="sample_code" jdbcType="VARCHAR" property="sampleCode" />
    <result column="test_method" jdbcType="VARCHAR" property="testMethod" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbggenerated, do not modify!
    -->
    id, fk_patient_id, his_pt_Id, group_id, group_name, item_code, item_name, result, 
    result_actual, value_unit, value_min, value_max, result_tips, reference, remark, 
    report_time, req_id, req_time, req_dept, sample_class, sample_time, send_doctor, 
    check_time, check_person, inspection_id, fk_tenant_id, create_time, assay_month, 
    assay_date, sample_code, test_method
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.String" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated, do not modify!
    -->
    select 
    <include refid="Base_Column_List" />
    from patient_assay_record
    where id = #{id,jdbcType=VARCHAR}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String">
    <!--
      WARNING - @mbggenerated, do not modify!
    -->
    delete from patient_assay_record
    where id = #{id,jdbcType=VARCHAR}
  </delete>
  <insert id="insert" parameterType="com.xtt.common.dao.model.PatientAssayRecord">
    <!--
      WARNING - @mbggenerated, do not modify!
    -->
    insert into patient_assay_record (id, fk_patient_id, his_pt_Id, 
      group_id, group_name, item_code, 
      item_name, result, result_actual, 
      value_unit, value_min, value_max, 
      result_tips, reference, remark, 
      report_time, req_id, req_time, 
      req_dept, sample_class, sample_time, 
      send_doctor, check_time, check_person, 
      inspection_id, fk_tenant_id, create_time, 
      assay_month, assay_date, sample_code, 
      test_method)
    values (#{id,jdbcType=VARCHAR}, #{fkPatientId,jdbcType=BIGINT}, #{hisPtId,jdbcType=VARCHAR}, 
      #{groupId,jdbcType=VARCHAR}, #{groupName,jdbcType=VARCHAR}, #{itemCode,jdbcType=VARCHAR}, 
      #{itemName,jdbcType=VARCHAR}, #{result,jdbcType=VARCHAR}, #{resultActual,jdbcType=DOUBLE}, 
      #{valueUnit,jdbcType=VARCHAR}, #{valueMin,jdbcType=DECIMAL}, #{valueMax,jdbcType=DECIMAL}, 
      #{resultTips,jdbcType=VARCHAR}, #{reference,jdbcType=VARCHAR}, #{remark,jdbcType=VARCHAR}, 
      #{reportTime,jdbcType=TIMESTAMP}, #{reqId,jdbcType=VARCHAR}, #{reqTime,jdbcType=TIMESTAMP}, 
      #{reqDept,jdbcType=VARCHAR}, #{sampleClass,jdbcType=VARCHAR}, #{sampleTime,jdbcType=TIMESTAMP}, 
      #{sendDoctor,jdbcType=VARCHAR}, #{checkTime,jdbcType=TIMESTAMP}, #{checkPerson,jdbcType=VARCHAR}, 
      #{inspectionId,jdbcType=VARCHAR}, #{fkTenantId,jdbcType=INTEGER}, #{createTime,jdbcType=TIMESTAMP}, 
      #{assayMonth,jdbcType=VARCHAR}, #{assayDate,jdbcType=VARCHAR}, #{sampleCode,jdbcType=VARCHAR}, 
      #{testMethod,jdbcType=VARCHAR})
  </insert>
  <insert id="insertSelective" parameterType="com.xtt.common.dao.model.PatientAssayRecord">
    <!--
      WARNING - @mbggenerated, do not modify!
    -->
    insert into patient_assay_record
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="id != null">
        id,
      </if>
      <if test="fkPatientId != null">
        fk_patient_id,
      </if>
      <if test="hisPtId != null">
        his_pt_Id,
      </if>
      <if test="groupId != null">
        group_id,
      </if>
      <if test="groupName != null">
        group_name,
      </if>
      <if test="itemCode != null">
        item_code,
      </if>
      <if test="itemName != null">
        item_name,
      </if>
      <if test="result != null">
        result,
      </if>
      <if test="resultActual != null">
        result_actual,
      </if>
      <if test="valueUnit != null">
        value_unit,
      </if>
      <if test="valueMin != null">
        value_min,
      </if>
      <if test="valueMax != null">
        value_max,
      </if>
      <if test="resultTips != null">
        result_tips,
      </if>
      <if test="reference != null">
        reference,
      </if>
      <if test="remark != null">
        remark,
      </if>
      <if test="reportTime != null">
        report_time,
      </if>
      <if test="reqId != null">
        req_id,
      </if>
      <if test="reqTime != null">
        req_time,
      </if>
      <if test="reqDept != null">
        req_dept,
      </if>
      <if test="sampleClass != null">
        sample_class,
      </if>
      <if test="sampleTime != null">
        sample_time,
      </if>
      <if test="sendDoctor != null">
        send_doctor,
      </if>
      <if test="checkTime != null">
        check_time,
      </if>
      <if test="checkPerson != null">
        check_person,
      </if>
      <if test="inspectionId != null">
        inspection_id,
      </if>
      <if test="fkTenantId != null">
        fk_tenant_id,
      </if>
      <if test="createTime != null">
        create_time,
      </if>
      <if test="assayMonth != null">
        assay_month,
      </if>
      <if test="assayDate != null">
        assay_date,
      </if>
      <if test="sampleCode != null">
        sample_code,
      </if>
      <if test="testMethod != null">
        test_method,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="id != null">
        #{id,jdbcType=VARCHAR},
      </if>
      <if test="fkPatientId != null">
        #{fkPatientId,jdbcType=BIGINT},
      </if>
      <if test="hisPtId != null">
        #{hisPtId,jdbcType=VARCHAR},
      </if>
      <if test="groupId != null">
        #{groupId,jdbcType=VARCHAR},
      </if>
      <if test="groupName != null">
        #{groupName,jdbcType=VARCHAR},
      </if>
      <if test="itemCode != null">
        #{itemCode,jdbcType=VARCHAR},
      </if>
      <if test="itemName != null">
        #{itemName,jdbcType=VARCHAR},
      </if>
      <if test="result != null">
        #{result,jdbcType=VARCHAR},
      </if>
      <if test="resultActual != null">
        #{resultActual,jdbcType=DOUBLE},
      </if>
      <if test="valueUnit != null">
        #{valueUnit,jdbcType=VARCHAR},
      </if>
      <if test="valueMin != null">
        #{valueMin,jdbcType=DECIMAL},
      </if>
      <if test="valueMax != null">
        #{valueMax,jdbcType=DECIMAL},
      </if>
      <if test="resultTips != null">
        #{resultTips,jdbcType=VARCHAR},
      </if>
      <if test="reference != null">
        #{reference,jdbcType=VARCHAR},
      </if>
      <if test="remark != null">
        #{remark,jdbcType=VARCHAR},
      </if>
      <if test="reportTime != null">
        #{reportTime,jdbcType=TIMESTAMP},
      </if>
      <if test="reqId != null">
        #{reqId,jdbcType=VARCHAR},
      </if>
      <if test="reqTime != null">
        #{reqTime,jdbcType=TIMESTAMP},
      </if>
      <if test="reqDept != null">
        #{reqDept,jdbcType=VARCHAR},
      </if>
      <if test="sampleClass != null">
        #{sampleClass,jdbcType=VARCHAR},
      </if>
      <if test="sampleTime != null">
        #{sampleTime,jdbcType=TIMESTAMP},
      </if>
      <if test="sendDoctor != null">
        #{sendDoctor,jdbcType=VARCHAR},
      </if>
      <if test="checkTime != null">
        #{checkTime,jdbcType=TIMESTAMP},
      </if>
      <if test="checkPerson != null">
        #{checkPerson,jdbcType=VARCHAR},
      </if>
      <if test="inspectionId != null">
        #{inspectionId,jdbcType=VARCHAR},
      </if>
      <if test="fkTenantId != null">
        #{fkTenantId,jdbcType=INTEGER},
      </if>
      <if test="createTime != null">
        #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="assayMonth != null">
        #{assayMonth,jdbcType=VARCHAR},
      </if>
      <if test="assayDate != null">
        #{assayDate,jdbcType=VARCHAR},
      </if>
      <if test="sampleCode != null">
        #{sampleCode,jdbcType=VARCHAR},
      </if>
      <if test="testMethod != null">
        #{testMethod,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.xtt.common.dao.model.PatientAssayRecord">
    <!--
      WARNING - @mbggenerated, do not modify!
    -->
    update patient_assay_record
    <set>
      <if test="fkPatientId != null">
        fk_patient_id = #{fkPatientId,jdbcType=BIGINT},
      </if>
      <if test="hisPtId != null">
        his_pt_Id = #{hisPtId,jdbcType=VARCHAR},
      </if>
      <if test="groupId != null">
        group_id = #{groupId,jdbcType=VARCHAR},
      </if>
      <if test="groupName != null">
        group_name = #{groupName,jdbcType=VARCHAR},
      </if>
      <if test="itemCode != null">
        item_code = #{itemCode,jdbcType=VARCHAR},
      </if>
      <if test="itemName != null">
        item_name = #{itemName,jdbcType=VARCHAR},
      </if>
      <if test="result != null">
        result = #{result,jdbcType=VARCHAR},
      </if>
      <if test="resultActual != null">
        result_actual = #{resultActual,jdbcType=DOUBLE},
      </if>
      <if test="valueUnit != null">
        value_unit = #{valueUnit,jdbcType=VARCHAR},
      </if>
      <if test="valueMin != null">
        value_min = #{valueMin,jdbcType=DECIMAL},
      </if>
      <if test="valueMax != null">
        value_max = #{valueMax,jdbcType=DECIMAL},
      </if>
      <if test="resultTips != null">
        result_tips = #{resultTips,jdbcType=VARCHAR},
      </if>
      <if test="reference != null">
        reference = #{reference,jdbcType=VARCHAR},
      </if>
      <if test="remark != null">
        remark = #{remark,jdbcType=VARCHAR},
      </if>
      <if test="reportTime != null">
        report_time = #{reportTime,jdbcType=TIMESTAMP},
      </if>
      <if test="reqId != null">
        req_id = #{reqId,jdbcType=VARCHAR},
      </if>
      <if test="reqTime != null">
        req_time = #{reqTime,jdbcType=TIMESTAMP},
      </if>
      <if test="reqDept != null">
        req_dept = #{reqDept,jdbcType=VARCHAR},
      </if>
      <if test="sampleClass != null">
        sample_class = #{sampleClass,jdbcType=VARCHAR},
      </if>
      <if test="sampleTime != null">
        sample_time = #{sampleTime,jdbcType=TIMESTAMP},
      </if>
      <if test="sendDoctor != null">
        send_doctor = #{sendDoctor,jdbcType=VARCHAR},
      </if>
      <if test="checkTime != null">
        check_time = #{checkTime,jdbcType=TIMESTAMP},
      </if>
      <if test="checkPerson != null">
        check_person = #{checkPerson,jdbcType=VARCHAR},
      </if>
      <if test="inspectionId != null">
        inspection_id = #{inspectionId,jdbcType=VARCHAR},
      </if>
      <if test="fkTenantId != null">
        fk_tenant_id = #{fkTenantId,jdbcType=INTEGER},
      </if>
      <if test="createTime != null">
        create_time = #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="assayMonth != null">
        assay_month = #{assayMonth,jdbcType=VARCHAR},
      </if>
      <if test="assayDate != null">
        assay_date = #{assayDate,jdbcType=VARCHAR},
      </if>
      <if test="sampleCode != null">
        sample_code = #{sampleCode,jdbcType=VARCHAR},
      </if>
      <if test="testMethod != null">
        test_method = #{testMethod,jdbcType=VARCHAR},
      </if>
    </set>
    where id = #{id,jdbcType=VARCHAR}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.xtt.common.dao.model.PatientAssayRecord">
    <!--
      WARNING - @mbggenerated, do not modify!
    -->
    update patient_assay_record
    set fk_patient_id = #{fkPatientId,jdbcType=BIGINT},
      his_pt_Id = #{hisPtId,jdbcType=VARCHAR},
      group_id = #{groupId,jdbcType=VARCHAR},
      group_name = #{groupName,jdbcType=VARCHAR},
      item_code = #{itemCode,jdbcType=VARCHAR},
      item_name = #{itemName,jdbcType=VARCHAR},
      result = #{result,jdbcType=VARCHAR},
      result_actual = #{resultActual,jdbcType=DOUBLE},
      value_unit = #{valueUnit,jdbcType=VARCHAR},
      value_min = #{valueMin,jdbcType=DECIMAL},
      value_max = #{valueMax,jdbcType=DECIMAL},
      result_tips = #{resultTips,jdbcType=VARCHAR},
      reference = #{reference,jdbcType=VARCHAR},
      remark = #{remark,jdbcType=VARCHAR},
      report_time = #{reportTime,jdbcType=TIMESTAMP},
      req_id = #{reqId,jdbcType=VARCHAR},
      req_time = #{reqTime,jdbcType=TIMESTAMP},
      req_dept = #{reqDept,jdbcType=VARCHAR},
      sample_class = #{sampleClass,jdbcType=VARCHAR},
      sample_time = #{sampleTime,jdbcType=TIMESTAMP},
      send_doctor = #{sendDoctor,jdbcType=VARCHAR},
      check_time = #{checkTime,jdbcType=TIMESTAMP},
      check_person = #{checkPerson,jdbcType=VARCHAR},
      inspection_id = #{inspectionId,jdbcType=VARCHAR},
      fk_tenant_id = #{fkTenantId,jdbcType=INTEGER},
      create_time = #{createTime,jdbcType=TIMESTAMP},
      assay_month = #{assayMonth,jdbcType=VARCHAR},
      assay_date = #{assayDate,jdbcType=VARCHAR},
      sample_code = #{sampleCode,jdbcType=VARCHAR},
      test_method = #{testMethod,jdbcType=VARCHAR}
    where id = #{id,jdbcType=VARCHAR}
  </update>
  
  <!-- 自定义 -->
  <resultMap extends="BaseResultMap" id="POResultMap" type="com.xtt.common.dao.po.PatientAssayRecordPO" />
  
  <select id="selectByCondition" parameterType="com.xtt.common.dao.model.PatientAssayRecord" resultMap="POResultMap">
      select 
      	par.*
      	,dhl.order_by as orderBy,dhl.min_value as `minValue`,dhl.max_value as `maxValue`,dhl.unit as unit,dhl.fk_dict_code AS fkDictCode,dhl.value_type as valueType
      	, pa.name as patientName
      FROM patient_assay_record par 
      LEFT JOIN dict_hospital_lab dhl ON dhl.item_code = par.item_code and dhl.fk_tenant_id = par.fk_tenant_id
      LEFT JOIN patient pa ON pa.id = par.fk_patient_id
      <where>
		<if test="fkPatientId != null">
		   par.fk_patient_id = #{fkPatientId}
		</if>
		<if test="hisPtId != null">
		  and par.his_pt_Id = #{hisPtId}
		</if>
		<if test="assayDate != null and assayDate != ''">
		  and par.assay_date = #{assayDate}
		</if>
		<if test="groupId != null and groupId != ''">
		  and par.group_id = #{groupId}
		</if>
		<if test="groupIds != null">
		  and par.group_id in 
		    <foreach close=")" collection="groupIds" item="item" open="(" separator=",">#{item}</foreach>
		</if>
		<if test="groupName != null">
		  and par.group_name = #{groupName}
		</if>
		<if test="itemCode != null">
		  and par.item_code = #{itemCode}
		</if>
		<if test="itemName != null">
		  and par.item_name = #{itemName}
		</if>
		<if test="result != null">
		  and par.result = #{result}
		</if>
		<if test="resultTips != null">
		  and par.result_tips = #{resultTips}
		</if>
		<if test="multResultTips != null">
		  and par.result_tips in 
		  <foreach close=")" collection="multResultTips" item="item" open="(" separator=",">#{item}</foreach>
		</if>
		<if test="remark != null">
		  and par.remark = #{remark}
		</if>
		<if test="reportTime != null">
		  and par.report_time = #{reportTime}
		</if>
		<if test="reqId != null and reqId != ''">
		  and par.req_id = #{reqId}
		</if>
		<if test="reqTime != null">
		  and par.req_time = #{reqTime}
		</if>
		<if test="sampleClass != null">
		  and par.sample_class = #{sampleClass}
		</if>
		<if test="sampleTime != null">
		  and par.sample_time = #{sampleTime}
		</if>
		<if test="sendDoctor != null">
		  and par.send_doctor = #{sendDoctor}
		</if>
		<if test="checkTime != null">
		  and par.check_time = #{checkTime}
		</if>
		<if test="checkPerson != null">
		  and par.check_person = #{checkPerson}
		</if>
		<if test="inspectionId != null">
		  and par.inspection_id = #{inspectionId}
		</if>
		<if test="fkTenantId != null">
		  and par.fk_tenant_id = #{fkTenantId}
		</if>
		<if test="createTime != null">
		  and par.create_time = #{createTime}
		</if>
		<if test="startDate != null">
			AND par.sample_time &gt;= #{startDate}
		</if>
		<if test="endDate != null">
			AND par.sample_time &lt;= #{endDate}
		</if>
		 AND par.group_id IS NOT NULL AND par.group_name IS NOT NULL
      </where>
      ORDER BY par.group_id ASC,par.item_code ASC
  </select>
  
  <select id="selectDateAssayRecord" parameterType="com.xtt.common.dao.model.PatientAssayRecord" resultMap="POResultMap">
      select par.assay_date,max(par.fk_patient_id) AS fk_patient_id
      from patient_assay_record par 
      <where>
	      <if test="fkPatientId != null">
	        par.fk_patient_id = #{fkPatientId}
	      </if>
	      <if test="fkTenantId != null">
	        and par.fk_tenant_id = #{fkTenantId}
	      </if>
	      <if test="groupId != null and groupId != ''">
		  	and par.group_id = #{groupId}
		  </if>
      </where>
      GROUP BY par.assay_date
      ORDER BY par.assay_date DESC
  </select>
  
  <select id="selectReportData" resultType="map">
      SELECT  par.result as value, par.assay_date as time FROM patient_assay_record par
      <where>
           par.fk_patient_id = #{patientId}
    	  <if test="itemCode != null">
	       	and par.item_code = #{itemCode}
	      </if>
          <if test="startTime != null">
           	and par.assay_date  &gt;= DATE_FORMAT(#{startTime},'%Y-%m-%d')
          </if>
          <if test="endTime != null">
          	and par.assay_date  &lt;= DATE_FORMAT(#{endTime},'%Y-%m-%d')
          </if>
      </where>
      ORDER BY par.assay_date ASC
  </select>
  
  <select id="selectReportByAssayTime" parameterType="com.xtt.common.dao.model.PatientAssayRecord" resultMap="POResultMap">
  	SELECT p.assay_month AS `month`
		, COUNT(p.id) as allCount
		,sum(CASE WHEN p.result_tips = '1' THEN 1 ELSE 0 END) okCount
	FROM patient_assay_record p
	LEFT JOIN dict_hospital_lab dhl ON dhl.item_code = p.item_code and dhl.fk_tenant_id = p.fk_tenant_id
	WHERE p.fk_tenant_id = #{fkTenantId}
	AND dhl.value_type = 1
	<if test="itemCode != null">
		AND p.item_code = #{itemCode}
	</if>
	<if test="startDate != null">
		AND p.sample_time &gt;= #{startDate}
	</if>
	<if test="endDate != null">
		AND p.sample_time &lt;= #{endDate}
	</if>
	GROUP BY p.assay_month
  </select>
  
  <select id="selectByMonth" parameterType="com.xtt.common.dao.model.PatientAssayRecord" resultMap="POResultMap">
  	SELECT p.*
		, pa.`name` as patientName
	FROM patient_assay_record p
	LEFT JOIN dict_hospital_lab dhl ON dhl.item_code = p.item_code and dhl.fk_tenant_id = p.fk_tenant_id
	INNER JOIN patient pa ON pa.id = p.fk_patient_id
	WHERE p.fk_tenant_id = #{fkTenantId}
	AND dhl.value_type = 1
	<if test="itemCode != null">
		AND p.item_code = #{itemCode}
	</if>
	<if test="startDate != null">
		AND p.sample_time &gt;= #{startDate}
	</if>
	<if test="endDate != null">
		AND p.sample_time &lt;= #{endDate}
	</if>
	order by pa.spell_initials, p.sample_time
  </select>
  
  <select id="selectStatisticsReport" parameterType="com.xtt.common.dao.model.PatientAssayRecord" resultMap="POResultMap">
  	SELECT p.assay_month as `month`
  		, count(CASE WHEN p.result IS NULL OR p.result='' THEN 0 ELSE cast(p.result as DECIMAL) END) as allCount
  		, sum(CASE WHEN p.result IS NULL OR p.result='' THEN 0 ELSE cast(p.result as DECIMAL) END) as allSum
  		, round(AVG(CASE WHEN p.result IS NULL OR p.result='' THEN 0 ELSE cast(p.result as DECIMAL) END), 2) as `avg`
  		, round(stddev_pop(CASE WHEN p.result IS NULL OR p.result='' THEN 0 ELSE cast(p.result as DECIMAL) END), 2) as `pop`
  	FROM patient_assay_record p 
  	LEFT JOIN dict_hospital_lab dhl ON dhl.item_code = p.item_code and dhl.fk_tenant_id = p.fk_tenant_id
  	WHERE p.fk_tenant_id = #{fkTenantId}
  	AND dhl.value_type = 1
  	<if test="itemCode != null">
		AND p.item_code = #{itemCode}
	</if>
	<if test="startDate != null">
		AND p.sample_time &gt;= #{startDate}
	</if>
	<if test="endDate != null">
		AND p.sample_time &lt;= #{endDate}
	</if>
	GROUP BY p.assay_month;
  </select>
  
  <select id="selectCategoryListByPatientId" resultType="map">
     SELECT par.group_id AS groupId,par.group_name AS groupName FROM patient_assay_record par 
     WHERE par.fk_patient_id =#{patientId} AND par.fk_tenant_id = #{tenantId} AND par.group_id IS NOT NULL AND par.group_name IS NOT NULL
     GROUP BY par.group_id, par.group_name
     ORDER BY par.group_id ASC
  </select>
  
  <select id="selectCategoryList" parameterType="com.xtt.common.dao.model.PatientAssayRecord" resultMap="POResultMap">
     SELECT par.* FROM patient_assay_record par 
     WHERE 
     par.fk_patient_id =#{fkPatientId}
     AND par.fk_tenant_id = #{fkTenantId}
     <if test="assayDate != null and assayDate != ''">
        AND par.assay_date = #{assayDate}
     </if>
     AND par.req_id IS NOT NULL 
     AND par.group_name IS NOT NULL
     GROUP BY par.req_id, par.group_name
     ORDER BY par.req_id ASC
  </select>
  
  <select id="selectByFkDictCode" parameterType="com.xtt.common.dao.model.PatientAssayRecord" resultMap="POResultMap">
  	SELECT par.*
  	,dhl.fk_dict_code AS fkDictCode
  	,p.name AS patientName
  	FROM patient_assay_record par
	LEFT JOIN dict_hospital_lab dhl ON dhl.item_code = par.item_code AND dhl.fk_tenant_id = par.fk_tenant_id
	LEFT JOIN patient p ON p.id = par.fk_patient_id AND p.fk_tenant_id = par.fk_tenant_id
	WHERE
		par.fk_tenant_id = #{fkTenantId}
	    AND	dhl.fk_dict_code = #{fkDictCode}
	    <if test="startDateStr != null">
	    	AND par.assay_date &gt;= #{startDateStr}
	    </if>
	    <if test="endDateStr != null">
	    	AND par.assay_date &lt;= #{endDateStr}
	    </if>
	    <if test="resultTips != null">
		  and par.result_tips = #{resultTips}
		</if>
		<if test="assayMonth != null and assayMonth != ''">
		  and par.assay_month = #{assayMonth}
		</if>
	    <if test="multResultTips != null">
		  and par.result_tips in 
		  <foreach close=")" collection="multResultTips" item="item" open="(" separator=",">#{item}</foreach>
		</if>
	ORDER BY
		par.item_code,par.fk_patient_id,par.assay_date
  </select>
</mapper>